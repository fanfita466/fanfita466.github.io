<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail Manager Pro - Gestión Masiva de Correos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== ESTILOS BASE ===== */
        :root {
            --primary: #0078d4;
            --primary-dark: #106ebe;
            --secondary: #00bcf2;
            --success: #107c10;
            --danger: #d13438;
            --warning: #ffb900;
            --dark: #201f1e;
            --light: #f3f2f1;
            --sidebar: #2d2c2c;
            --outlook-bg: #f2f2f2;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --gray-800: #343a40;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ===== PANEL DE LOGIN ===== */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .password-input {
            width: 100%;
            padding: 18px;
            margin: 25px 0;
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: var(--gray-100);
        }
        
        .password-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }
        
        /* ===== DASHBOARD PRINCIPAL ===== */
        .dashboard {
            display: none;
            width: 100%;
            min-height: 100vh;
            background: var(--light);
        }
        
        /* Header Superior */
        .top-bar {
            background: white;
            color: var(--dark);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-300);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2rem;
            color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stats-bar {
            display: flex;
            gap: 25px;
            font-size: 14px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Layout Principal */
        .main-layout {
            display: flex;
            min-height: calc(100vh - 70px);
        }
        
        /* Sidebar de Cuentas */
        .accounts-sidebar {
            width: 380px;
            background: white;
            border-right: 1px solid var(--gray-300);
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
        }
        
        .accounts-header {
            padding: 25px;
            border-bottom: 1px solid var(--gray-300);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .upload-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 120, 212, 0.2);
        }
        
        /* Búsqueda Global */
        .global-search-container {
            padding: 20px;
            background: white;
            border-bottom: 1px solid var(--gray-300);
            position: sticky;
            top: 70px;
            z-index: 900;
        }
        
        #globalSearch {
            width: 100%;
            padding: 16px 20px;
            padding-left: 50px;
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            font-size: 16px;
            background: var(--gray-100) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236c757d' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'%3E%3C/path%3E%3C/svg%3E") no-repeat 20px center;
            transition: all 0.3s;
        }
        
        #globalSearch:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }
        
        .search-filters {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            flex: 1;
        }
        
        /* Lista de Cuentas */
        .accounts-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .account-item {
            background: white;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .account-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(0, 120, 212, 0.1);
        }
        
        .account-item.active {
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.1), rgba(0, 188, 242, 0.05));
            border-color: var(--primary);
        }
        
        .account-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .account-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }
        
        .account-info {
            flex: 1;
        }
        
        .account-email {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
            word-break: break-all;
        }
        
        .account-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: var(--gray-600);
        }
        
        /* Área Principal */
        .main-area {
            flex: 1;
            background: var(--outlook-bg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Header de Outlook */
        .outlook-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid var(--gray-300);
            display: none;
            align-items: center;
            justify-content: space-between;
        }
        
        .current-account-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .folder-stats {
            display: flex;
            gap: 25px;
        }
        
        .folder-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Controles de Email */
        .email-controls {
            display: flex;
            gap: 10px;
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid var(--gray-300);
            display: none;
        }
        
        /* Lista de Emails */
        .emails-container {
            flex: 1;
            overflow: hidden;
            display: none;
        }
        
        .emails-list {
            height: 100%;
            overflow-y: auto;
            background: white;
        }
        
        .email-list-item {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .email-list-item:hover {
            background: var(--gray-100);
        }
        
        .email-list-item.selected {
            background: rgba(0, 120, 212, 0.05);
            border-left: 4px solid var(--primary);
        }
        
        .email-list-item.unread {
            background: rgba(0, 120, 212, 0.02);
        }
        
        .email-list-item.unread .email-subject {
            font-weight: 700;
        }
        
        .email-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .email-sender-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .email-sender-info {
            flex: 1;
        }
        
        .email-sender {
            font-weight: 600;
            color: var(--dark);
        }
        
        .email-subject {
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .email-preview {
            color: var(--gray-600);
            font-size: 14px;
            margin-bottom: 10px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .email-tags {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .email-tag {
            padding: 4px 10px;
            background: var(--gray-200);
            border-radius: 20px;
            font-size: 12px;
            color: var(--gray-800);
        }
        
        /* Vista de Email */
        .email-viewer {
            width: 50%;
            background: white;
            padding: 30px;
            overflow-y: auto;
            border-left: 1px solid var(--gray-300);
            display: none;
        }
        
        .email-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-300);
        }
        
        .email-subject-large {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 20px;
            line-height: 1.3;
        }
        
        .email-from {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .sender-details {
            flex: 1;
        }
        
        /* Vista de Todas las Cuentas */
        .all-accounts-view {
            display: none;
            padding: 30px;
            overflow-y: auto;
        }
        
        .account-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .account-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        /* Estadísticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10001;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Notificaciones */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10002;
            transform: translateX(150%);
            transition: transform 0.4s ease;
            border-left: 6px solid var(--primary);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .accounts-sidebar {
                width: 350px;
            }
        }
        
        @media (max-width: 992px) {
            .main-layout {
                flex-direction: column;
            }
            
            .accounts-sidebar {
                width: 100%;
                max-height: 50vh;
            }
            
            .email-viewer {
                width: 100%;
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 1000;
            }
        }
        
        @media (max-width: 768px) {
            .login-container {
                padding: 30px 20px;
            }
            
            .top-bar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .stats-bar {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* Scrollbar Personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-200);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }
        
        /* Loader */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 10003;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 20px;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--gray-300);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Paginación */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: white;
            border-top: 1px solid var(--gray-300);
        }
        
        .page-btn {
            padding: 10px 15px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <div id="loaderText">Cargando correos...</div>
    </div>
    
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div style="margin-bottom: 40px;">
                <i class="fas fa-mail-bulk" style="font-size: 4rem; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                <h1 style="margin: 20px 0 10px 0; color: var(--dark);">Mail Manager Pro</h1>
                <p style="color: var(--gray-600); font-size: 18px;">Gestión masiva de correos electrónicos</p>
            </div>
            
            <input type="password" 
                   id="passwordInput" 
                   class="password-input" 
                   placeholder="Contraseña de acceso: 30305090"
                   onkeypress="if(event.key === 'Enter') login()"
                   autocomplete="off">
            
            <button onclick="login()" 
                    style="width: 100%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 18px; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 20px rgba(102, 126, 234, 0.3)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                <i class="fas fa-sign-in-alt"></i> Acceder al Sistema
            </button>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--gray-300);">
                <p style="color: var(--gray-600); font-size: 14px;">
                    <i class="fas fa-info-circle"></i> Soporta 500-1000 cuentas con búsqueda avanzada
                </p>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Principal -->
    <div class="dashboard" id="dashboard">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="logo">
                <i class="fas fa-mail-bulk"></i>
                <div>
                    <h2 style="color: var(--dark);">Mail Manager Pro</h2>
                    <p style="font-size: 13px; color: var(--gray-600);">Gestión centralizada de correos masivos</p>
                </div>
            </div>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <i class="fas fa-users" style="color: var(--primary);"></i>
                    <span>Cuentas: <strong id="totalAccounts">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-envelope" style="color: var(--success);"></i>
                    <span>Correos: <strong id="totalEmails">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-search" style="color: var(--warning);"></i>
                    <span>Búsquedas: <strong id="searchCount">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock" style="color: var(--danger);"></i>
                    <span id="sessionTimer">Sesión activa</span>
                </div>
            </div>
            
            <div class="user-menu">
                <button onclick="showAllAccountsView()" 
                        style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-right: 10px; font-weight: 600;">
                    <i class="fas fa-globe"></i> Vista Global
                </button>
                <button onclick="logout()" 
                        style="background: var(--gray-200); color: var(--dark); border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
        
        <!-- Layout Principal -->
        <div class="main-layout">
            <!-- Sidebar de Cuentas -->
            <div class="accounts-sidebar">
                <div class="accounts-header">
                    <button class="upload-btn" onclick="showUploadModal()">
                        <i class="fas fa-file-upload"></i> Cargar Archivo TXT
                    </button>
                    <button class="upload-btn" onclick="loadSampleData()" style="background: linear-gradient(135deg, #28a745, #20c997);">
                        <i class="fas fa-download"></i> Cargar Datos de Ejemplo
                    </button>
                    <button class="upload-btn" onclick="generateMassiveData()" style="background: linear-gradient(135deg, #6f42c1, #9b4dca);">
                        <i class="fas fa-database"></i> Generar 500+ Cuentas
                    </button>
                </div>
                
                <!-- Búsqueda Global -->
                <div class="global-search-container">
                    <input type="text" 
                           id="globalSearch" 
                           placeholder="Buscar en todos los correos (ej: 'amazon factura julio 2024')..."
                           onkeyup="debouncedSearch()">
                    
                    <div class="search-filters">
                        <select id="searchScope" class="filter-select" onchange="performSearch()">
                            <option value="all">Todas las cuentas</option>
                            <option value="current">Cuenta actual</option>
                            <option value="unread">No leídos</option>
                            <option value="starred">Destacados</option>
                        </select>
                        
                        <select id="searchField" class="filter-select" onchange="performSearch()">
                            <option value="all">Todo el contenido</option>
                            <option value="subject">Solo asunto</option>
                            <option value="sender">Remitente</option>
                            <option value="body">Cuerpo del mensaje</option>
                            <option value="attachments">Archivos adjuntos</option>
                        </select>
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="clearSearch()" 
                                style="padding: 8px 15px; background: var(--gray-200); border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-times"></i> Limpiar
                        </button>
                        <button onclick="showAdvancedSearch()" 
                                style="padding: 8px 15px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-search-plus"></i> Búsqueda Avanzada
                        </button>
                    </div>
                </div>
                
                <!-- Lista de Cuentas -->
                <div class="accounts-list" id="accountsList">
                    <!-- Las cuentas aparecerán aquí -->
                </div>
            </div>
            
            <!-- Área Principal -->
            <div class="main-area">
                <!-- Header de Outlook -->
                <div class="outlook-header" id="outlookHeader">
                    <div class="current-account-info">
                        <div class="account-avatar" id="currentAvatar" style="width: 60px; height: 60px; font-size: 24px;"></div>
                        <div>
                            <div style="font-weight: 700; font-size: 20px; color: var(--dark);" id="currentEmail">Selecciona una cuenta</div>
                            <div style="font-size: 14px; color: var(--gray-600);" id="accountInfo">0 correos cargados</div>
                        </div>
                    </div>
                    
                    <div class="folder-stats" id="folderStats">
                        <!-- Estadísticas dinámicas -->
                    </div>
                </div>
                
                <!-- Controles de Email -->
                <div class="email-controls" id="emailControls">
                    <div style="display: flex; gap: 10px; flex: 1;">
                        <button class="action-btn" onclick="markAsRead()">
                            <i class="fas fa-envelope-open"></i> Marcar como leído
                        </button>
                        <button class="action-btn" onclick="markAsUnread()">
                            <i class="fas fa-envelope"></i> Marcar como no leído
                        </button>
                        <button class="action-btn" onclick="toggleStar()">
                            <i class="far fa-star"></i> Destacar
                        </button>
                        <button class="action-btn" onclick="deleteEmail()">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <select class="filter-select" style="width: 150px;" onchange="filterByFolder(this.value)">
                            <option value="all">Todos los correos</option>
                            <option value="inbox">Bandeja de entrada</option>
                            <option value="starred">Destacados</option>
                            <option value="important">Importantes</option>
                        </select>
                        
                        <button class="action-btn" onclick="refreshEmails()">
                            <i class="fas fa-redo"></i> Actualizar
                        </button>
                    </div>
                </div>
                
                <!-- Contenedor de Emails -->
                <div class="emails-container" id="emailsContainer">
                    <div class="emails-list" id="emailsList">
                        <!-- Los emails aparecerán aquí -->
                    </div>
                    
                    <!-- Vista de Email -->
                    <div class="email-viewer" id="emailViewer">
                        <!-- Contenido dinámico -->
                    </div>
                </div>
                
                <!-- Vista de Todas las Cuentas -->
                <div class="all-accounts-view" id="allAccountsView">
                    <h2 style="margin-bottom: 30px; color: var(--dark);">
                        <i class="fas fa-globe-americas"></i> Vista Global de Todas las Cuentas
                    </h2>
                    
                    <!-- Estadísticas -->
                    <div class="stats-grid" id="globalStats">
                        <!-- Estadísticas dinámicas -->
                    </div>
                    
                    <!-- Lista de todas las cuentas -->
                    <div id="allAccountsList">
                        <!-- Cuentas aparecerán aquí -->
                    </div>
                </div>
                
                <!-- Vista Inicial -->
                <div id="emptyView" style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--gray-600); padding: 40px;">
                    <i class="fas fa-mail-bulk" style="font-size: 6rem; color: var(--gray-300); margin-bottom: 30px;"></i>
                    <h2 style="margin-bottom: 15px; color: var(--dark);">Bienvenido a Mail Manager Pro</h2>
                    <p style="font-size: 18px; text-align: center; max-width: 600px; margin-bottom: 30px;">
                        Carga tus cuentas de correo o usa los datos de ejemplo para comenzar.<br>
                        Gestiona 500+ cuentas con búsqueda avanzada en tiempo real.
                    </p>
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        <button onclick="showUploadModal()" 
                                style="padding: 15px 30px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600;">
                            <i class="fas fa-file-upload"></i> Cargar Cuentas
                        </button>
                        <button onclick="loadSampleData()" 
                                style="padding: 15px 30px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600;">
                            <i class="fas fa-download"></i> Usar Ejemplo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para cargar archivo -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 25px; color: var(--dark); display: flex; align-items: center; gap: 15px;">
                <i class="fas fa-file-upload" style="color: var(--primary);"></i>
                Cargar Archivo de Cuentas
            </h2>
            
            <p style="margin-bottom: 20px; color: var(--gray-600); line-height: 1.6;">
                Sube un archivo TXT con tus cuentas de correo. Soporta múltiples formatos y hasta 1000 cuentas.
            </p>
            
            <div style="background: var(--gray-100); padding: 20px; border-radius: 12px; margin: 25px 0;">
                <p style="font-weight: 700; margin-bottom: 15px; color: var(--dark);">
                    <i class="fas fa-info-circle"></i> Formatos aceptados:
                </p>
                <div style="font-family: monospace; background: white; padding: 15px; border-radius: 8px; font-size: 14px; color: var(--primary);">
                    email@hotmail.com:contraseña123<br>
                    usuario@outlook.com|clave456<br>
                    cuenta@live.com password789<br>
                    correo@gmail.com;pass2024
                </div>
            </div>
            
            <input type="file" id="fileInput" accept=".txt" style="display: none;" onchange="handleFileUpload(event)">
            
            <div id="dropZone" 
                 style="border: 3px dashed var(--gray-400); border-radius: 15px; padding: 50px 20px; text-align: center; margin: 25px 0; cursor: pointer; transition: all 0.3s;"
                 onmouseover="this.style.borderColor='var(--primary)'; this.style.backgroundColor='rgba(0,120,212,0.05)'"
                 onmouseout="this.style.borderColor='var(--gray-400)'; this.style.backgroundColor='transparent'">
                <i class="fas fa-cloud-upload-alt" style="font-size: 3.5rem; color: var(--gray-500); margin-bottom: 20px;"></i>
                <h3 style="margin-bottom: 10px; color: var(--dark);">Arrastra y suelta tu archivo aquí</h3>
                <p style="color: var(--gray-600); margin-bottom: 20px;">o haz clic para seleccionar</p>
                <button onclick="document.getElementById('fileInput').click()" 
                        style="padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    <i class="fas fa-folder-open"></i> Seleccionar Archivo
                </button>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button onclick="closeModal()" 
                        style="flex: 1; background: var(--gray-300); color: var(--dark); border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;"
                        onmouseover="this.style.backgroundColor='var(--gray-400)'"
                        onmouseout="this.style.backgroundColor='var(--gray-300)'">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button onclick="loadSampleData()" 
                        style="flex: 1; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(40, 167, 69, 0.3)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i class="fas fa-download"></i> Usar Datos de Ejemplo
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Búsqueda Avanzada -->
    <div class="modal" id="advancedSearchModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 25px; color: var(--dark);">
                <i class="fas fa-search-plus"></i> Búsqueda Avanzada
            </h2>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--dark);">Términos de búsqueda:</label>
                <input type="text" id="advancedQuery" 
                       style="width: 100%; padding: 15px; border: 2px solid var(--gray-300); border-radius: 10px; font-size: 16px;"
                       placeholder="Ej: amazon AND factura NOT spam">
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div>
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--dark);">Fecha desde:</label>
                    <input type="date" id="dateFrom" style="width: 100%; padding: 12px; border: 2px solid var(--gray-300); border-radius: 10px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--dark);">Fecha hasta:</label>
                    <input type="date" id="dateTo" style="width: 100%; padding: 12px; border: 2px solid var(--gray-300); border-radius: 10px;">
                </div>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--dark);">Filtros adicionales:</label>
                <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="filterUnread">
                        Solo no leídos
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="filterStarred">
                        Solo destacados
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="filterAttachments">
                        Con archivos adjuntos
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="filterImportant">
                        Solo importantes
                    </label>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button onclick="closeAdvancedSearch()" 
                        style="flex: 1; background: var(--gray-300); color: var(--dark); border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button onclick="performAdvancedSearch()" 
                        style="flex: 1; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notificación -->
    <div class="notification" id="notification">
        <div style="display: flex; align-items: flex-start; gap: 20px;">
            <i class="fas fa-info-circle" id="notificationIcon" style="font-size: 1.5rem;"></i>
            <div>
                <h4 id="notificationTitle" style="margin: 0 0 8px 0; color: var(--dark); font-size: 16px;">Notificación</h4>
                <p id="notificationMessage" style="margin: 0; color: var(--gray-600); font-size: 14px; line-height: 1.4;">Mensaje de notificación</p>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ===== CONFIGURACIÓN =====
        const MASTER_PASSWORD = "30305090";
        let accounts = [];
        let currentAccount = null;
        let allEmails = new Map(); // Almacena todos los emails de todas las cuentas
        let currentFolder = 'inbox';
        let searchIndex = new Map(); // Índice para búsqueda rápida
        let searchCount = 0;
        let searchDebounceTimer;
        
        // ===== SISTEMA DE BÚSQUEDA =====
        class EmailSearchEngine {
            constructor() {
                this.index = {
                    fullText: new Map(),     // emailId -> contenido completo
                    bySender: new Map(),     // remitente -> [emailIds]
                    bySubject: new Map(),    // palabra -> [emailIds]
                    byDate: new Map(),       // fecha -> [emailIds]
                    byFolder: new Map(),     // carpeta -> [emailIds]
                    byAccount: new Map()     // cuentaId -> [emailIds]
                };
            }
            
            indexEmail(email, accountId) {
                const emailId = `${accountId}_${email.id}`;
                
                // Indexar contenido completo (para búsqueda general)
                const fullText = `${email.sender.name} ${email.sender.email} ${email.subject} ${email.body}`.toLowerCase();
                this.index.fullText.set(emailId, fullText);
                
                // Indexar por remitente
                const senderKey = email.sender.email.toLowerCase();
                if (!this.index.bySender.has(senderKey)) {
                    this.index.bySender.set(senderKey, []);
                }
                this.index.bySender.get(senderKey).push(emailId);
                
                // Indexar por palabras del asunto
                const subjectWords = email.subject.toLowerCase().split(/\s+/);
                subjectWords.forEach(word => {
                    if (word.length > 2) { // Ignorar palabras muy cortas
                        if (!this.index.bySubject.has(word)) {
                            this.index.bySubject.set(word, []);
                        }
                        this.index.bySubject.get(word).push(emailId);
                    }
                });
                
                // Indexar por fecha
                const dateKey = email.date.toISOString().split('T')[0];
                if (!this.index.byDate.has(dateKey)) {
                    this.index.byDate.set(dateKey, []);
                }
                this.index.byDate.get(dateKey).push(emailId);
                
                // Indexar por carpeta
                if (!this.index.byFolder.has(email.folder)) {
                    this.index.byFolder.set(email.folder, []);
                }
                this.index.byFolder.get(email.folder).push(emailId);
                
                // Indexar por cuenta
                if (!this.index.byAccount.has(accountId)) {
                    this.index.byAccount.set(accountId, []);
                }
                this.index.byAccount.get(accountId).push(emailId);
            }
            
            search(query, filters = {}) {
                const results = new Set();
                const queryLower = query.toLowerCase().trim();
                
                if (!queryLower && Object.keys(filters).length === 0) {
                    return []; // Búsqueda vacía
                }
                
                // Búsqueda por texto
                if (queryLower) {
                    // Dividir en palabras clave
                    const keywords = queryLower.split(/\s+/).filter(k => k.length > 2);
                    
                    // Buscar en índice de asunto
                    keywords.forEach(keyword => {
                        if (this.index.bySubject.has(keyword)) {
                            this.index.bySubject.get(keyword).forEach(id => results.add(id));
                        }
                    });
                    
                    // Buscar en contenido completo
                    this.index.fullText.forEach((text, emailId) => {
                        if (text.includes(queryLower)) {
                            results.add(emailId);
                        }
                    });
                }
                
                // Aplicar filtros
                let filteredResults = Array.from(results);
                
                if (filters.accountId) {
                    const accountEmails = this.index.byAccount.get(filters.accountId) || [];
                    filteredResults = filteredResults.filter(id => accountEmails.includes(id));
                }
                
                if (filters.folder) {
                    const folderEmails = this.index.byFolder.get(filters.folder) || [];
                    filteredResults = filteredResults.filter(id => folderEmails.includes(id));
                }
                
                if (filters.unread) {
                    filteredResults = filteredResults.filter(id => {
                        const [accountId, emailId] = id.split('_');
                        const account = accounts.find(a => a.id == accountId);
                        if (account && account.emails) {
                            const email = account.emails.find(e => e.id == emailId);
                            return email && email.isUnread;
                        }
                        return false;
                    });
                }
                
                if (filters.sender) {
                    const senderEmails = this.index.bySender.get(filters.sender.toLowerCase()) || [];
                    filteredResults = filteredResults.filter(id => senderEmails.includes(id));
                }
                
                if (filters.dateFrom) {
                    filteredResults = filteredResults.filter(id => {
                        const [accountId, emailId] = id.split('_');
                        const account = accounts.find(a => a.id == accountId);
                        if (account && account.emails) {
                            const email = account.emails.find(e => e.id == emailId);
                            return email && new Date(email.date) >= new Date(filters.dateFrom);
                        }
                        return false;
                    });
                }
                
                if (filters.dateTo) {
                    filteredResults = filteredResults.filter(id => {
                        const [accountId, emailId] = id.split('_');
                        const account = accounts.find(a => a.id == accountId);
                        if (account && account.emails) {
                            const email = account.emails.find(e => e.id == emailId);
                            return email && new Date(email.date) <= new Date(filters.dateTo);
                        }
                        return false;
                    });
                }
                
                return filteredResults;
            }
        }
        
        const searchEngine = new EmailSearchEngine();
        
        // ===== FUNCIONES PRINCIPALES =====
        function login() {
            const password = document.getElementById('passwordInput').value;
            
            if (password === MASTER_PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                showNotification('success', 'Acceso concedido', 'Bienvenido a Mail Manager Pro');
                
                // Iniciar temporizador de sesión
                startSessionTimer();
            } else {
                showNotification('error', 'Error de acceso', 'Contraseña incorrecta');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        function logout() {
            if (confirm('¿Estás seguro de que quieres salir?')) {
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('passwordInput').value = '';
                showNotification('info', 'Sesión cerrada', 'Has salido del sistema');
            }
        }
        
        function startSessionTimer() {
            let minutes = 0;
            setInterval(() => {
                minutes++;
                document.getElementById('sessionTimer').textContent = `Sesión: ${minutes}m`;
            }, 60000);
        }
        
        // ===== GESTIÓN DE CUENTAS MASIVAS =====
        function showUploadModal() {
            document.getElementById('uploadModal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('uploadModal').style.display = 'none';
            document.getElementById('advancedSearchModal').style.display = 'none';
        }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showLoader('Procesando archivo...');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    parseAccountsFile(content);
                    closeModal();
                    showNotification('success', 'Archivo cargado', `${accounts.length} cuentas procesadas`);
                    hideLoader();
                } catch (error) {
                    showNotification('error', 'Error', 'Formato de archivo incorrecto');
                    hideLoader();
                    console.error('Error processing file:', error);
                }
            };
            reader.onerror = function() {
                showNotification('error', 'Error', 'No se pudo leer el archivo');
                hideLoader();
            };
            reader.readAsText(file);
        }
        
        function parseAccountsFile(content) {
            const lines = content.split('\n');
            const newAccounts = [];
            
            lines.forEach((line, index) => {
                line = line.trim();
                if (!line || line.startsWith('#') || line.startsWith('//')) return;
                
                let email, password;
                
                // Detectar múltiples formatos
                const patterns = [
                    /^([^:]+):(.+)$/,          // email:password
                    /^([^|]+)\|(.+)$/,         // email|password
                    /^([^\s]+)\s+(.+)$/,       // email password
                    /^([^;]+);(.+)$/           // email;password
                ];
                
                for (const pattern of patterns) {
                    const match = line.match(pattern);
                    if (match) {
                        email = match[1].trim();
                        password = match[2].trim();
                        break;
                    }
                }
                
                if (email && password && email.includes('@') && email.includes('.')) {
                    const provider = getProvider(email);
                    newAccounts.push({
                        id: accounts.length + newAccounts.length + 1,
                        email: email,
                        password: password,
                        verified: true,
                        provider: provider,
                        unread: Math.floor(Math.random() * 50),
                        total: Math.floor(Math.random() * 500) + 100,
                        lastCheck: new Date().toLocaleString(),
                        emails: [],
                        stats: {
                            inbox: 0,
                            sent: 0,
                            drafts: 0,
                            spam: 0,
                            trash: 0,
                            starred: 0,
                            important: 0
                        }
                    });
                }
            });
            
            if (newAccounts.length > 0) {
                accounts.push(...newAccounts);
                updateAccountsList();
                updateStats();
                
                // Generar emails para las nuevas cuentas
                newAccounts.forEach(account => {
                    generateAccountEmails(account);
                });
            }
        }
        
        function getProvider(email) {
            const domains = {
                'hotmail.': 'Hotmail',
                'outlook.': 'Outlook',
                'live.': 'Live',
                'msn.': 'MSN',
                'gmail.': 'Gmail',
                'yahoo.': 'Yahoo',
                'icloud.': 'iCloud'
            };
            
            for (const [domain, provider] of Object.entries(domains)) {
                if (email.includes(`@${domain}`)) {
                    return provider;
                }
            }
            return 'Otro';
        }
        
        function updateAccountsList() {
            const container = document.getElementById('accountsList');
            
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--gray-600);">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h4 style="margin-bottom: 10px;">No hay cuentas cargadas</h4>
                        <p>Usa los botones superiores para cargar tus cuentas</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            accounts.forEach((account, index) => {
                const firstLetter = account.email.charAt(0).toUpperCase();
                const isActive = currentAccount && currentAccount.id === account.id;
                const providerColor = getProviderColor(account.provider);
                
                html += `
                    <div class="account-item ${isActive ? 'active' : ''} fade-in" 
                         onclick="selectAccount(${index})" 
                         style="animation-delay: ${index * 0.05}s">
                        <div class="account-header">
                            <div class="account-avatar" style="background: ${providerColor}">
                                ${firstLetter}
                            </div>
                            <div class="account-info">
                                <div class="account-email">${account.email}</div>
                                <div class="account-stats">
                                    <span><i class="fas fa-envelope"></i> ${account.total} correos</span>
                                    <span><i class="fas fa-envelope-open"></i> ${account.unread} no leídos</span>
                                    <span><i class="fas fa-shield-alt"></i> ${account.provider}</span>
                                </div>
                            </div>
                            <div style="color: var(--gray-500); font-size: 12px;">
                                ${account.lastCheck}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('totalAccounts').textContent = accounts.length;
        }
        
        function getProviderColor(provider) {
            const colors = {
                'Hotmail': '#0078d4',
                'Outlook': '#00bcf2',
                'Live': '#107c10',
                'Gmail': '#ea4335',
                'Yahoo': '#720e9e',
                'iCloud': '#34c759',
                'MSN': '#ffb900',
                'Otro': '#6c757d'
            };
            return colors[provider] || colors['Otro'];
        }
        
        // ===== GENERACIÓN DE EMAILS MASIVOS =====
        function generateAccountEmails(account) {
            const senders = [
                { name: 'SAT México', email: 'notificaciones@sat.gob.mx', color: '#d83b01' },
                { name: 'Microsoft Support', email: 'support@microsoft.com', color: '#0078d4' },
                { name: 'Banco Nacional', email: 'notificaciones@bancanacional.com', color: '#107c10' },
                { name: 'Amazon', email: 'no-reply@amazon.com', color: '#ff9900' },
                { name: 'Departamento RRHH', email: 'rrhh@empresa.com', color: '#7719aa' },
                { name: 'Netflix', email: 'info@netflix.com', color: '#e50914' },
                { name: 'Google', email: 'no-reply@google.com', color: '#4285f4' },
                { name: 'LinkedIn', email: 'updates@linkedin.com', color: '#0077b5' },
                { name: 'Facebook', email: 'security@facebook.com', color: '#1877f2' },
                { name: 'Apple', email: 'noreply@apple.com', color: '#000000' },
                { name: 'PayPal', email: 'service@paypal.com', color: '#003087' },
                { name: 'Spotify', email: 'news@spotify.com', color: '#1db954' },
                { name: 'Uber', email: 'uber@uber.com', color: '#000000' },
                { name: 'Airbnb', email: 'info@airbnb.com', color: '#ff5a5f' },
                { name: 'Mercado Libre', email: 'ventas@mercadolibre.com', color: '#ffe600' }
            ];
            
            const subjects = [
                'Factura pendiente de pago',
                'Actualización de seguridad requerida',
                'Contrato por firmar - Urgente',
                'Recordatorio de pago vencido',
                'Confirmación de pedido #2024-001',
                'Alerta de actividad inusual en tu cuenta',
                'Nueva factura adjunta',
                'Renovación de contrato anual',
                'Documentos importantes para revisión',
                'Oferta especial - Descuento exclusivo',
                'Confirmación de reunión',
                'Estado de cuenta actualizado',
                'Verificación de identidad requerida',
                'Promoción especial para clientes',
                'Recordatorio de cita médica',
                'Informe mensual de actividades',
                'Suscripción renovada automáticamente',
                'Cambio en los términos de servicio',
                'Encuesta de satisfacción',
                'Actualización de política de privacidad'
            ];
            
            const bodies = [
                'Estimado cliente, le informamos que tiene una factura pendiente de pago. Por favor, realice el pago a la brevedad para evitar recargos.',
                'Hemos detectado actividad inusual en su cuenta. Por seguridad, le recomendamos cambiar su contraseña inmediatamente.',
                'Adjunto encontrará el contrato para su revisión y firma. Por favor, revíselo cuidadosamente antes de proceder.',
                'Su pedido ha sido confirmado y está en proceso de preparación. Recibirá una notificación cuando sea enviado.',
                'Su suscripción se renovará automáticamente en los próximos días. Si desea cancelar, por favor hágalo antes de la fecha de renovación.',
                'Le enviamos los documentos solicitados para su revisión. Por favor, confirme recepción.',
                'Tiene una cita programada para mañana. Por favor, confirme su asistencia.',
                'Su cuenta ha sido actualizada exitosamente. Ahora tiene acceso a todas las funcionalidades premium.',
                'Hemos aplicado un descuento especial a su última compra. Adjunto encontrará la factura actualizada.',
                'Por favor, complete la encuesta de satisfacción para ayudarnos a mejorar nuestro servicio.',
                'Se ha detectado un intento de inicio de sesión desde una nueva ubicación.',
                'Su garantía está por expirar. Considere extenderla para mantener su protección.',
                'Felicitaciones, ha sido seleccionado para nuestra promoción especial.',
                'Informamos sobre cambios importantes en nuestros servicios a partir del próximo mes.',
                'Le recordamos que su próximo pago está programado para la próxima semana.'
            ];
            
            const folders = ['inbox', 'sent', 'drafts', 'spam', 'trash'];
            const folderWeights = [60, 20, 10, 5, 5]; // Porcentajes
            
            account.emails = [];
            account.stats = { inbox: 0, sent: 0, drafts: 0, spam: 0, trash: 0, starred: 0, important: 0 };
            
            // Generar entre 100-500 emails por cuenta
            const emailCount = Math.floor(Math.random() * 400) + 100;
            
            for (let i = 0; i < emailCount; i++) {
                // Seleccionar carpeta basada en pesos
                const folderIndex = weightedRandom(folderWeights);
                const folder = folders[folderIndex];
                
                const sender = senders[Math.floor(Math.random() * senders.length)];
                const daysAgo = Math.floor(Math.random() * 365); // Último año
                const date = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);
                const hasAttachment = Math.random() > 0.6;
                const isUnread = folder === 'inbox' && Math.random() > 0.5;
                const isStarred = Math.random() > 0.8;
                const isImportant = Math.random() > 0.7;
                
                const email = {
                    id: `email_${i}`,
                    folder: folder,
                    sender: sender,
                    subject: subjects[Math.floor(Math.random() * subjects.length)],
                    body: bodies[Math.floor(Math.random() * bodies.length)],
                    date: date,
                    hasAttachment: hasAttachment,
                    isUnread: isUnread,
                    isStarred: isStarred,
                    isImportant: isImportant,
                    tags: generateTags(),
                    attachments: hasAttachment ? generateAttachments() : []
                };
                
                account.emails.push(email);
                account.stats[folder]++;
                if (isStarred) account.stats.starred++;
                if (isImportant) account.stats.important++;
                
                // Indexar para búsqueda
                searchEngine.indexEmail(email, account.id);
            }
            
            account.total = emailCount;
            account.unread = account.emails.filter(e => e.isUnread).length;
        }
        
        function weightedRandom(weights) {
            const total = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * total;
            
            for (let i = 0; i < weights.length; i++) {
                if (random < weights[i]) return i;
                random -= weights[i];
            }
            
            return weights.length - 1;
        }
        
        function generateTags() {
            const tags = [];
            const allTags = ['Factura', 'Importante', 'Trabajo', 'Personal', 'Urgente', 'Leer más tarde', 'Seguimiento', 'Archivar'];
            
            // 0-3 tags aleatorios
            const tagCount = Math.floor(Math.random() * 4);
            for (let i = 0; i < tagCount; i++) {
                const tag = allTags[Math.floor(Math.random() * allTags.length)];
                if (!tags.includes(tag)) {
                    tags.push(tag);
                }
            }
            
            return tags;
        }
        
        function generateAttachments() {
            const attachments = [];
            const types = [
                { name: 'factura.pdf', icon: 'fa-file-pdf', color: '#d13438' },
                { name: 'contrato.docx', icon: 'fa-file-word', color: '#2b579a' },
                { name: 'presentacion.pptx', icon: 'fa-file-powerpoint', color: '#d24726' },
                { name: 'datos.xlsx', icon: 'fa-file-excel', color: '#217346' },
                { name: 'imagen.png', icon: 'fa-file-image', color: '#0078d4' },
                { name: 'documento.zip', icon: 'fa-file-archive', color: '#ffb900' }
            ];
            
            // 1-3 archivos adjuntos
            const count = Math.floor(Math.random() * 3) + 1;
            for (let i = 0; i < count; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                attachments.push({
                    name: `${type.name.split('.')[0]}_${Math.random().toString(36).substr(2, 5)}.${type.name.split('.')[1]}`,
                    type: type.name.split('.')[1],
                    icon: type.icon,
                    color: type.color,
                    size: `${(Math.random() * 10 + 0.5).toFixed(1)} MB`
                });
            }
            
            return attachments;
        }
        
        // ===== SELECCIÓN Y VISUALIZACIÓN =====
        function selectAccount(index) {
            currentAccount = accounts[index];
            
            // Actualizar UI
            document.getElementById('currentAvatar').textContent = currentAccount.email.charAt(0).toUpperCase();
            document.getElementById('currentAvatar').style.background = getProviderColor(currentAccount.provider);
            document.getElementById('currentEmail').textContent = currentAccount.email;
            document.getElementById('accountInfo').textContent = 
                `${currentAccount.total} correos • ${currentAccount.unread} no leídos • ${currentAccount.provider}`;
            
            // Mostrar secciones
            document.getElementById('outlookHeader').style.display = 'flex';
            document.getElementById('emailControls').style.display = 'flex';
            document.getElementById('emailsContainer').style.display = 'flex';
            document.getElementById('emptyView').style.display = 'none';
            document.getElementById('allAccountsView').style.display = 'none';
            
            // Actualizar estadísticas
            updateFolderStats();
            
            // Actualizar lista de cuentas
            updateAccountsList();
            
            // Mostrar emails de la cuenta
            showFolder('inbox');
            
            showNotification('info', 'Cuenta seleccionada', `Mostrando ${currentAccount.total} correos de ${currentAccount.email}`);
        }
        
        function updateFolderStats() {
            if (!currentAccount) return;
            
            const container = document.getElementById('folderStats');
            const stats = currentAccount.stats;
            
            container.innerHTML = `
                <div class="folder-stat">
                    <i class="fas fa-inbox" style="color: var(--primary);"></i>
                    <span>${stats.inbox || 0}</span>
                </div>
                <div class="folder-stat">
                    <i class="fas fa-star" style="color: var(--warning);"></i>
                    <span>${stats.starred || 0}</span>
                </div>
                <div class="folder-stat">
                    <i class="fas fa-exclamation-circle" style="color: var(--danger);"></i>
                    <span>${stats.important || 0}</span>
                </div>
                <div class="folder-stat">
                    <i class="fas fa-paperclip" style="color: var(--success);"></i>
                    <span>${currentAccount.emails.filter(e => e.hasAttachment).length}</span>
                </div>
                <div class="folder-stat">
                    <i class="fas fa-envelope" style="color: var(--gray-600);"></i>
                    <span>${currentAccount.unread || 0} no leídos</span>
                </div>
            `;
        }
        
        function showFolder(folder) {
            if (!currentAccount) return;
            
            currentFolder = folder;
            const filteredEmails = currentAccount.emails.filter(email => email.folder === folder);
            displayEmails(filteredEmails);
        }
        
        function displayEmails(emailList) {
            const container = document.getElementById('emailsList');
            
            if (!emailList || emailList.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 100px 20px; color: var(--gray-600);">
                        <i class="fas fa-inbox" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h3 style="margin-bottom: 10px;">No hay correos en esta carpeta</h3>
                        <p>Intenta cambiar de carpeta o ajustar tus filtros de búsqueda</p>
                    </div>
                `;
                document.getElementById('emailViewer').style.display = 'none';
                return;
            }
            
            let html = '';
            emailList.forEach((email, index) => {
                const timeAgo = getTimeAgo(email.date);
                const isSelected = index === 0;
                
                html += `
                    <div class="email-list-item ${email.isUnread ? 'unread' : ''} ${isSelected ? 'selected' : ''} fade-in" 
                         onclick="selectEmail('${email.id}', this)" 
                         style="animation-delay: ${index * 0.02}s">
                        <div class="email-meta">
                            <div class="email-sender-avatar" style="background: ${email.sender.color}">
                                ${email.sender.name.charAt(0)}
                            </div>
                            <div class="email-sender-info">
                                <div class="email-sender">
                                    ${email.sender.name}
                                    ${email.isStarred ? ' <i class="fas fa-star" style="color: #ffb900; font-size: 12px;"></i>' : ''}
                                    ${email.isImportant ? ' <i class="fas fa-exclamation-circle" style="color: #d13438; font-size: 12px;"></i>' : ''}
                                </div>
                                <div class="email-subject">
                                    ${email.hasAttachment ? '<i class="fas fa-paperclip" style="color: var(--gray-600); margin-right: 5px; font-size: 12px;"></i>' : ''}
                                    ${email.subject}
                                </div>
                            </div>
                            <div style="color: var(--gray-600); font-size: 14px; white-space: nowrap;">
                                ${timeAgo}
                            </div>
                        </div>
                        <div class="email-preview">
                            ${email.body.substring(0, 120)}${email.body.length > 120 ? '...' : ''}
                        </div>
                        
                        ${email.tags.length > 0 ? `
                            <div class="email-tags">
                                ${email.tags.map(tag => `<span class="email-tag">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Mostrar primer email si hay
            if (emailList.length > 0) {
                selectEmail(emailList[0].id);
            } else {
                document.getElementById('emailViewer').style.display = 'none';
            }
        }
        
        function selectEmail(emailId, element = null) {
            if (!currentAccount) return;
            
            const email = currentAccount.emails.find(e => e.id === emailId);
            if (!email) return;
            
            // Marcar como leído
            if (email.isUnread) {
                email.isUnread = false;
                currentAccount.unread = Math.max(0, currentAccount.unread - 1);
                updateFolderStats();
            }
            
            // Actualizar selección visual
            if (element) {
                document.querySelectorAll('.email-list-item').forEach(item => {
                    item.classList.remove('selected');
                });
                element.classList.add('selected');
            }
            
            // Mostrar email
            showEmail(email);
        }
        
        function showEmail(email) {
            const viewer = document.getElementById('emailViewer');
            viewer.style.display = 'block';
            
            viewer.innerHTML = `
                <div class="email-header">
                    <h2 class="email-subject-large">${email.subject}</h2>
                    <div class="email-from">
                        <div class="email-sender-avatar" style="width: 60px; height: 60px; font-size: 24px; background: ${email.sender.color}">
                            ${email.sender.name.charAt(0)}
                        </div>
                        <div class="sender-details">
                            <div style="font-weight: 700; font-size: 18px; color: var(--dark);">
                                ${email.sender.name}
                                ${email.isStarred ? ' <i class="fas fa-star" style="color: #ffb900;"></i>' : ''}
                                ${email.isImportant ? ' <i class="fas fa-exclamation-circle" style="color: #d13438;"></i>' : ''}
                            </div>
                            <div style="color: var(--gray-600); font-size: 15px; margin-top: 5px;">
                                ${email.sender.email}
                            </div>
                        </div>
                        <div style="margin-left: auto; text-align: right;">
                            <div style="font-weight: 600; color: var(--dark);">
                                ${email.date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </div>
                            <div style="color: var(--gray-600); font-size: 14px; margin-top: 5px;">
                                ${email.date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="email-body" style="line-height: 1.8; font-size: 16px; color: var(--dark);">
                    <p>${email.body}</p>
                    <br>
                    <p style="color: var(--gray-600);">Para: ${currentAccount.email}</p>
                    <br>
                    <p style="font-style: italic;">Atentamente,<br><strong>${email.sender.name}</strong></p>
                </div>
                
                ${email.attachments.length > 0 ? `
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--gray-300);">
                        <h3 style="margin-bottom: 20px; color: var(--dark);">
                            <i class="fas fa-paperclip"></i> Archivos adjuntos (${email.attachments.length})
                        </h3>
                        <div id="emailAttachments">
                            ${email.attachments.map(attachment => `
                                <div style="display: flex; align-items: center; gap: 20px; padding: 15px; background: var(--gray-100); border-radius: 12px; margin-bottom: 10px; border-left: 4px solid ${attachment.color};">
                                    <i class="fas ${attachment.icon}" style="font-size: 2rem; color: ${attachment.color};"></i>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--dark);">${attachment.name}</div>
                                        <div style="color: var(--gray-600); font-size: 14px;">
                                            ${attachment.type.toUpperCase()} • ${attachment.size}
                                        </div>
                                    </div>
                                    <button onclick="downloadAttachment('${attachment.name}')" 
                                            style="background: ${attachment.color}; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;"
                                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)'"
                                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                        <i class="fas fa-download"></i> Descargar
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--gray-300);">
                    <div style="display: flex; gap: 15px;">
                        <button onclick="replyToEmail()" 
                                style="padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-reply"></i> Responder
                        </button>
                        <button onclick="forwardEmail()" 
                                style="padding: 12px 25px; background: var(--gray-300); color: var(--dark); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-share"></i> Reenviar
                        </button>
                        <button onclick="deleteEmail()" 
                                style="padding: 12px 25px; background: var(--danger); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                        <button onclick="toggleStarEmail()" 
                                style="padding: 12px 25px; background: var(--warning); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-left: auto;">
                            <i class="fas fa-star"></i> Destacar
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ===== SISTEMA DE BÚSQUEDA AVANZADA =====
        function debouncedSearch() {
            clearTimeout(searchDebounceTimer);
            searchDebounceTimer = setTimeout(() => {
                performSearch();
            }, 300);
        }
        
        function performSearch() {
            const query = document.getElementById('globalSearch').value.trim();
            const scope = document.getElementById('searchScope').value;
            const field = document.getElementById('searchField').value;
            
            if (!query && scope === 'all') {
                // Si no hay búsqueda, mostrar vista normal
                if (currentAccount) {
                    showFolder(currentFolder);
                }
                return;
            }
            
            searchCount++;
            document.getElementById('searchCount').textContent = searchCount;
            
            let filters = {};
            
            if (scope === 'current' && currentAccount) {
                filters.accountId = currentAccount.id;
            } else if (scope === 'unread') {
                filters.unread = true;
            } else if (scope === 'starred') {
                // Filtro manual para destacados
            }
            
            // Realizar búsqueda
            const emailIds = searchEngine.search(query, filters);
            
            // Filtrar resultados por campo si es necesario
            let filteredEmails = [];
            
            if (currentAccount) {
                filteredEmails = currentAccount.emails.filter(email => {
                    return emailIds.includes(`${currentAccount.id}_${email.id}`);
                });
            } else {
                // Búsqueda global - obtener emails de todas las cuentas
                const allFilteredEmails = [];
                emailIds.forEach(emailId => {
                    const [accountId, id] = emailId.split('_');
                    const account = accounts.find(a => a.id == accountId);
                    if (account) {
                        const email = account.emails.find(e => e.id === id);
                        if (email) {
                            allFilteredEmails.push({
                                ...email,
                                accountEmail: account.email,
                                accountId: account.id
                            });
                        }
                    }
                });
                filteredEmails = allFilteredEmails;
            }
            
            // Mostrar resultados
            displaySearchResults(filteredEmails, query);
        }
        
        function displaySearchResults(emails, query) {
            const container = document.getElementById('emailsList');
            
            if (emails.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 100px 20px; color: var(--gray-600);">
                        <i class="fas fa-search" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h3 style="margin-bottom: 10px;">No se encontraron resultados</h3>
                        <p>Intenta con otros términos de búsqueda</p>
                        <p style="font-size: 14px; color: var(--gray-500); margin-top: 10px;">Búsqueda: "${query}"</p>
                    </div>
                `;
                document.getElementById('emailViewer').style.display = 'none';
                return;
            }
            
            let html = `
                <div style="padding: 20px; background: var(--gray-100); border-bottom: 1px solid var(--gray-300);">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-search" style="color: var(--primary);"></i>
                        <div>
                            <strong>${emails.length} resultados</strong> encontrados para: "${query}"
                        </div>
                        <button onclick="clearSearch()" 
                                style="margin-left: auto; padding: 8px 15px; background: var(--gray-300); border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-times"></i> Limpiar búsqueda
                        </button>
                    </div>
                </div>
            `;
            
            emails.forEach((email, index) => {
                const timeAgo = getTimeAgo(email.date);
                const isSelected = index === 0;
                const accountEmail = email.accountEmail || currentAccount.email;
                
                html += `
                    <div class="email-list-item ${email.isUnread ? 'unread' : ''} ${isSelected ? 'selected' : ''}" 
                         onclick="selectEmail('${email.id}', this)">
                        <div class="email-meta">
                            <div class="email-sender-avatar" style="background: ${email.sender.color}">
                                ${email.sender.name.charAt(0)}
                            </div>
                            <div class="email-sender-info">
                                <div class="email-sender">
                                    ${email.sender.name}
                                    ${email.isStarred ? ' <i class="fas fa-star" style="color: #ffb900; font-size: 12px;"></i>' : ''}
                                    ${email.isImportant ? ' <i class="fas fa-exclamation-circle" style="color: #d13438; font-size: 12px;"></i>' : ''}
                                </div>
                                <div class="email-subject">
                                    ${email.hasAttachment ? '<i class="fas fa-paperclip" style="color: var(--gray-600); margin-right: 5px; font-size: 12px;"></i>' : ''}
                                    ${email.subject}
                                </div>
                                ${email.accountEmail ? `
                                    <div style="font-size: 12px; color: var(--gray-600); margin-top: 3px;">
                                        <i class="fas fa-envelope"></i> ${email.accountEmail}
                                    </div>
                                ` : ''}
                            </div>
                            <div style="color: var(--gray-600); font-size: 14px; white-space: nowrap;">
                                ${timeAgo}
                            </div>
                        </div>
                        <div class="email-preview">
                            ${highlightSearchTerms(email.body.substring(0, 120), query)}${email.body.length > 120 ? '...' : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Mostrar primer resultado si hay
            if (emails.length > 0) {
                selectEmail(emails[0].id);
            } else {
                document.getElementById('emailViewer').style.display = 'none';
            }
        }
        
        function highlightSearchTerms(text, query) {
            if (!query) return text;
            
            const terms = query.toLowerCase().split(/\s+/).filter(term => term.length > 2);
            let highlighted = text;
            
            terms.forEach(term => {
                const regex = new RegExp(`(${term})`, 'gi');
                highlighted = highlighted.replace(regex, '<mark style="background: #fff3cd; padding: 2px 0;">$1</mark>');
            });
            
            return highlighted;
        }
        
        function clearSearch() {
            document.getElementById('globalSearch').value = '';
            if (currentAccount) {
                showFolder(currentFolder);
            }
        }
        
        function showAdvancedSearch() {
            document.getElementById('advancedSearchModal').style.display = 'flex';
        }
        
        function closeAdvancedSearch() {
            document.getElementById('advancedSearchModal').style.display = 'none';
        }
        
        function performAdvancedSearch() {
            const query = document.getElementById('advancedQuery').value.trim();
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const unread = document.getElementById('filterUnread').checked;
            const starred = document.getElementById('filterStarred').checked;
            const attachments = document.getElementById('filterAttachments').checked;
            const important = document.getElementById('filterImportant').checked;
            
            const filters = {};
            
            if (dateFrom) filters.dateFrom = dateFrom;
            if (dateTo) filters.dateTo = dateTo;
            if (unread) filters.unread = true;
            if (starred) {
                // Filtro especial para destacados
            }
            if (attachments) {
                // Filtro especial para adjuntos
            }
            if (important) {
                // Filtro especial para importantes
            }
            
            // Actualizar búsqueda global
            document.getElementById('globalSearch').value = query;
            performSearch();
            closeAdvancedSearch();
        }
        
        // ===== VISTA GLOBAL =====
        function showAllAccountsView() {
            document.getElementById('outlookHeader').style.display = 'none';
            document.getElementById('emailControls').style.display = 'none';
            document.getElementById('emailsContainer').style.display = 'none';
            document.getElementById('emptyView').style.display = 'none';
            document.getElementById('allAccountsView').style.display = 'block';
            
            updateGlobalView();
        }
        
        function updateGlobalView() {
            updateGlobalStats();
            displayAllAccounts();
        }
        
        function updateGlobalStats() {
            const container = document.getElementById('globalStats');
            
            let totalEmails = 0;
            let totalUnread = 0;
            let totalStarred = 0;
            let totalImportant = 0;
            let totalWithAttachments = 0;
            
            accounts.forEach(account => {
                totalEmails += account.total || 0;
                totalUnread += account.unread || 0;
                totalStarred += account.stats?.starred || 0;
                totalImportant += account.stats?.important || 0;
                totalWithAttachments += account.emails?.filter(e => e.hasAttachment).length || 0;
            });
            
            container.innerHTML = `
                <div class="stat-card">
                    <i class="fas fa-users" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 15px;"></i>
                    <h3 style="margin-bottom: 10px; color: var(--dark);">${accounts.length}</h3>
                    <p style="color: var(--gray-600);">Cuentas activas</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-envelope" style="font-size: 2.5rem; color: var(--success); margin-bottom: 15px;"></i>
                    <h3 style="margin-bottom: 10px; color: var(--dark);">${totalEmails.toLocaleString()}</h3>
                    <p style="color: var(--gray-600);">Correos totales</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-envelope-open" style="font-size: 2.5rem; color: var(--warning); margin-bottom: 15px;"></i>
                    <h3 style="margin-bottom: 10px; color: var(--dark);">${totalUnread.toLocaleString()}</h3>
                    <p style="color: var(--gray-600);">No leídos</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-paperclip" style="font-size: 2.5rem; color: var(--danger); margin-bottom: 15px;"></i>
                    <h3 style="margin-bottom: 10px; color: var(--dark);">${totalWithAttachments.toLocaleString()}</h3>
                    <p style="color: var(--gray-600);">Con adjuntos</p>
                </div>
            `;
            
            document.getElementById('totalEmails').textContent = totalEmails.toLocaleString();
        }
        
        function displayAllAccounts() {
            const container = document.getElementById('allAccountsList');
            
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--gray-600);">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h4 style="margin-bottom: 10px;">No hay cuentas cargadas</h4>
                        <p>Usa los botones superiores para cargar tus cuentas</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            accounts.forEach((account, index) => {
                const providerColor = getProviderColor(account.provider);
                const attachmentsCount = account.emails?.filter(e => e.hasAttachment).length || 0;
                
                html += `
                    <div class="account-card fade-in" onclick="selectAccount(${index})" 
                         style="animation-delay: ${index * 0.05}s">
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                            <div class="account-avatar" style="width: 70px; height: 70px; font-size: 28px; background: ${providerColor}">
                                ${account.email.charAt(0).toUpperCase()}
                            </div>
                            <div style="flex: 1;">
                                <h3 style="margin-bottom: 5px; color: var(--dark);">${account.email}</h3>
                                <div style="color: var(--gray-600); font-size: 14px;">
                                    <span style="background: ${providerColor}; color: white; padding: 3px 10px; border-radius: 20px; font-size: 12px;">
                                        ${account.provider}
                                    </span>
                                    <span style="margin-left: 15px;">
                                        <i class="fas fa-clock"></i> Última verificación: ${account.lastCheck}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="text-align: center; padding: 15px; background: var(--gray-100); border-radius: 10px;">
                                <div style="font-weight: 700; font-size: 24px; color: var(--dark);">${account.total}</div>
                                <div style="font-size: 13px; color: var(--gray-600);">Correos totales</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(0, 120, 212, 0.1); border-radius: 10px;">
                                <div style="font-weight: 700; font-size: 24px; color: var(--primary);">${account.unread}</div>
                                <div style="font-size: 13px; color: var(--primary);">No leídos</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(255, 185, 0, 0.1); border-radius: 10px;">
                                <div style="font-weight: 700; font-size: 24px; color: var(--warning);">${account.stats?.starred || 0}</div>
                                <div style="font-size: 13px; color: var(--warning);">Destacados</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(209, 52, 56, 0.1); border-radius: 10px;">
                                <div style="font-weight: 700; font-size: 24px; color: var(--danger);">${attachmentsCount}</div>
                                <div style="font-size: 13px; color: var(--danger);">Con adjuntos</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ===== FUNCIONES DE UTILIDAD =====
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            const weeks = Math.floor(days / 7);
            const months = Math.floor(days / 30);
            
            if (minutes < 60) return `${minutes}m`;
            if (hours < 24) return `${hours}h`;
            if (days < 7) return `${days}d`;
            if (weeks < 4) return `${weeks} sem`;
            if (months < 12) return `${months} m`;
            return date.toLocaleDateString('es-ES', { month: 'short', year: 'numeric' });
        }
        
        function showLoader(text = 'Cargando...') {
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loaderText').textContent = text;
        }
        
        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
        }
        
        function showNotification(type, title, message) {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            // Configurar tipo
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };
            
            const colors = {
                'success': '#28a745',
                'error': '#dc3545',
                'warning': '#ffc107',
                'info': '#17a2b8'
            };
            
            icon.className = `fas ${icons[type] || 'fa-info-circle'}`;
            icon.style.color = colors[type] || '#17a2b8';
            notification.style.borderLeftColor = colors[type] || '#17a2b8';
            
            // Configurar contenido
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // Mostrar
            notification.classList.add('show');
            
            // Ocultar después de 4 segundos
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        function updateStats() {
            let totalEmails = accounts.reduce((sum, acc) => sum + (acc.total || 0), 0);
            document.getElementById('totalEmails').textContent = totalEmails.toLocaleString();
        }
        
        // ===== DATOS DE EJEMPLO =====
        function loadSampleData() {
            showLoader('Cargando datos de ejemplo...');
            
            setTimeout(() => {
                accounts = [
                    {
                        id: 1,
                        email: 'pobapi@outlook.es',
                        password: 'pueblo12',
                        verified: true,
                        provider: 'Outlook',
                        unread: 5,
                        total: 87,
                        lastCheck: 'Hoy 5:08 p.m.',
                        emails: [],
                        stats: { inbox: 0, sent: 0, drafts: 0, spam: 0, trash: 0, starred: 0, important: 0 }
                    },
                    {
                        id: 2,
                        email: 'pool-gold@outlook.es',
                        password: 'futbol06',
                        verified: true,
                        provider: 'Outlook',
                        unread: 12,
                        total: 156,
                        lastCheck: 'Hoy 4:30 p.m.',
                        emails: [],
                        stats: { inbox: 0, sent: 0, drafts: 0, spam: 0, trash: 0, starred: 0, important: 0 }
                    },
                    {
                        id: 3,
                        email: 'uropenagos7@outlook.es',
                        password: 'juanca90',
                        verified: true,
                        provider: 'Outlook',
                        unread: 3,
                        total: 42,
                        lastCheck: 'Hoy 3:45 p.m.',
                        emails: [],
                        stats: { inbox: 0, sent: 0, drafts: 0, spam: 0, trash: 0, starred: 0, important: 0 }
                    },
                    {
                        id: 4,
                        email: 'pompaem_2014@hotmail.com',
                        password: 'paem2014',
                        verified: true,
                        provider: 'Hotmail',
                        unread: 8,
                        total: 203,
                        lastCheck: 'Ayer 2:15 p.m.',
                        emails: [],
                        stats: { inbox: 0, sent: 0, drafts: 0, spam: 0, trash: 0, starred: 0, important: 0 }
                    }
                ];
                
                // Generar emails para cada cuenta
                accounts.forEach(account => {
                    generateAccountEmails(account);
                });
                
                updateAccountsList();
                updateStats();
                hideLoader();
                
                showNotification('success', 'Datos de ejemplo cargados', `${accounts.length} cuentas con correos de prueba`);
                
                // Seleccionar primera cuenta automáticamente
                setTimeout(() => {
                    if (accounts.length > 0) {
                        selectAccount(0);
                    }
                }, 500);
                
                closeModal();
            }, 1500);
        }
        
        function generateMassiveData() {
            showLoader('Generando 500+ cuentas de prueba...');
            
            setTimeout(() => {
                const newAccounts = [];
                const domains = ['hotmail.com', 'outlook.es', 'gmail.com', 'yahoo.com', 'live.com'];
                const names = ['juan', 'maria', 'carlos', 'ana', 'pedro', 'laura', 'miguel', 'sofia', 'david', 'elena'];
                const surnames = ['garcia', 'rodriguez', 'gonzalez', 'fernandez', 'lopez', 'martinez', 'sanchez', 'perez', 'gomez', 'diaz'];
                
                for (let i = 0; i < 500; i++) {
                    const name = names[Math.floor(Math.random() * names.length)];
                    const surname = surnames[Math.floor(Math.random() * surnames.length)];
                    const domain = domains[Math.floor(Math.random() * domains.length)];
                    const number = Math.floor(Math.random() * 9999);
                    
                    newAccounts.push({
                        id: accounts.length + i + 1,
                        email: `${name}.${surname}${number}@${domain}`,
                        password: 'password' + Math.floor(Math.random() * 10000),
                        verified: Math.random() > 0.1,
                        provider: getProvider(domain),
                        unread: Math.floor(Math.random() * 50),
                        total: Math.floor(Math.random() * 400) + 100,
                        lastCheck: new Date().toLocaleString(),
                        emails: [],
                        stats: { inbox: 0, sent: 0, drafts: 0, spam: 0, trash: 0, starred: 0, important: 0 }
                    });
                }
                
                accounts.push(...newAccounts);
                
                // Generar emails para las nuevas cuentas
                newAccounts.forEach(account => {
                    generateAccountEmails(account);
                });
                
                updateAccountsList();
                updateStats();
                hideLoader();
                
                showNotification('success', 'Datos masivos generados', `Se agregaron ${newAccounts.length} cuentas de prueba`);
                
                closeModal();
            }, 2000);
        }
        
        // ===== FUNCIONES DE EMAIL =====
        function markAsRead() {
            if (!currentAccount) return;
            
            const selectedEmail = document.querySelector('.email-list-item.selected');
            if (selectedEmail) {
                const emailId = selectedEmail.getAttribute('data-email-id');
                const email = currentAccount.emails.find(e => e.id === emailId);
                if (email && email.isUnread) {
                    email.isUnread = false;
                    currentAccount.unread = Math.max(0, currentAccount.unread - 1);
                    selectedEmail.classList.remove('unread');
                    updateFolderStats();
                    showNotification('success', 'Email marcado', 'Correo marcado como leído');
                }
            }
        }
        
        function markAsUnread() {
            if (!currentAccount) return;
            
            const selectedEmail = document.querySelector('.email-list-item.selected');
            if (selectedEmail) {
                const emailId = selectedEmail.getAttribute('data-email-id');
                const email = currentAccount.emails.find(e => e.id === emailId);
                if (email && !email.isUnread) {
                    email.isUnread = true;
                    currentAccount.unread++;
                    selectedEmail.classList.add('unread');
                    updateFolderStats();
                    showNotification('success', 'Email marcado', 'Correo marcado como no leído');
                }
            }
        }
        
        function toggleStar() {
            if (!currentAccount) return;
            
            const selectedEmail = document.querySelector('.email-list-item.selected');
            if (selectedEmail) {
                const emailId = selectedEmail.getAttribute('data-email-id');
                const email = currentAccount.emails.find(e => e.id === emailId);
                if (email) {
                    email.isStarred = !email.isStarred;
                    currentAccount.stats.starred += email.isStarred ? 1 : -1;
                    
                    // Actualizar UI
                    const starIcon = selectedEmail.querySelector('.fa-star');
                    if (starIcon) {
                        starIcon.style.display = email.isStarred ? 'inline' : 'none';
                    }
                    
                    updateFolderStats();
                    showNotification('success', 'Email actualizado', 
                        email.isStarred ? 'Correo destacado' : 'Correo removido de destacados');
                }
            }
        }
        
        function deleteEmail() {
            if (!currentAccount || !confirm('¿Estás seguro de que quieres eliminar este correo?')) return;
            
            const selectedEmail = document.querySelector('.email-list-item.selected');
            if (selectedEmail) {
                const emailId = selectedEmail.getAttribute('data-email-id');
                const emailIndex = currentAccount.emails.findIndex(e => e.id === emailId);
                
                if (emailIndex !== -1) {
                    const email = currentAccount.emails[emailIndex];
                    
                    // Mover a la carpeta trash
                    email.folder = 'trash';
                    currentAccount.stats.trash++;
                    
                    // Restar de la carpeta anterior
                    if (email.folder !== 'trash') {
                        currentAccount.stats[email.folder] = Math.max(0, currentAccount.stats[email.folder] - 1);
                    }
                    
                    // Si estaba en inbox y no leído, actualizar contador
                    if (email.folder === 'inbox' && email.isUnread) {
                        currentAccount.unread = Math.max(0, currentAccount.unread - 1);
                    }
                    
                    // Remover de la vista actual
                    selectedEmail.remove();
                    
                    updateFolderStats();
                    showNotification('success', 'Email eliminado', 'Correo movido a la papelera');
                }
            }
        }
        
        function refreshEmails() {
            if (!currentAccount) return;
            
            showLoader('Actualizando correos...');
            
            setTimeout(() => {
                // Simular actualización
                const newEmailCount = Math.floor(Math.random() * 5);
                if (newEmailCount > 0) {
                    // Aquí iría la lógica para agregar nuevos emails
                    showNotification('info', 'Actualización completa', `${newEmailCount} nuevos correos encontrados`);
                } else {
                    showNotification('info', 'Actualización completa', 'No hay nuevos correos');
                }
                
                hideLoader();
            }, 1000);
        }
        
        function filterByFolder(folder) {
            if (!currentAccount) return;
            
            if (folder === 'all') {
                // Mostrar todos los correos de la cuenta
                const allEmails = currentAccount.emails;
                displayEmails(allEmails);
            } else {
                showFolder(folder);
            }
        }
        
        function downloadAttachment(filename) {
            showNotification('info', 'Descarga simulada', `Descargando ${filename}`);
            // En una implementación real, aquí iría la lógica de descarga
        }
        
        function replyToEmail() {
            showNotification('info', 'Respuesta', 'Funcionalidad de respuesta en desarrollo');
        }
        
        function forwardEmail() {
            showNotification('info', 'Reenvío', 'Funcionalidad de reenvío en desarrollo');
        }
        
        function toggleStarEmail() {
            showNotification('info', 'Destacado', 'Email marcado como destacado');
        }
        
        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos del modal
            document.getElementById('uploadModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            document.getElementById('advancedSearchModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAdvancedSearch();
                }
            });
            
            // Permitir Enter en password
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // Configurar zona de arrastrar y soltar
            const dropZone = document.getElementById('dropZone');
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--primary)';
                this.style.backgroundColor = 'rgba(0,120,212,0.1)';
            });
            
            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--gray-400)';
                this.style.backgroundColor = 'transparent';
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--gray-400)';
                this.style.backgroundColor = 'transparent';
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                        const event = { target: { files: [file] } };
                        handleFileUpload(event);
                    } else {
                        showNotification('error', 'Error', 'Solo se aceptan archivos TXT');
                    }
                }
            });
            
            // Mostrar versión
            console.log('Mail Manager Pro v2.0 - Sistema de gestión masiva de correos');
        });
    </script>
</body>
</html>
